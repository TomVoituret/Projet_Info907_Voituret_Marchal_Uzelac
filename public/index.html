<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modern Weapon Catalogue</title>
  <script src="main.js"></script>
    <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  
  <!-- Font Awesome CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <header class="text-center mb-4">

      <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
          <a class="navbar-brand" href="#">Gun Finder</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Categories</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">About</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Contact</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

 
    <div id="ontology" class="ontology">
      <h1 class="text-center mb-4">Arbre Décisionnel Dynamique des Armes</h1>
      <div class="text-center mb-3">
        <button id="resetButton" class="btn btn-danger d-flex flex-wrap">Reset</button>
      </div>
      <div id="buttonContainer" class="d-flex flex-wrap">
        <!-- Dynamic buttons will appear here -->
      </div>
      <div id="resultContainer">
        <!-- Dynamic results table -->
        <table id="resultTable" class="result-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Nom</th>
              <th>Autre</th>
              <th>Autre</th>
              <!-- Ajoutez autant de colonnes que nécessaire -->
            </tr>
          </thead>
          <tbody>
            <!-- Les données seront insérées ici -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
    <!-- Results Section -->
    <div id="results">
      <h3>Type d'utilisation</h3>
      <div class="row" id="resultsContainer">
        <!-- Example Weapon Card 1 -->
        <div class="col-md-4 mb-3">
          <div class="card h-100">
            <img src="https://www.ft.com/__origami/service/image/v2/images/raw/https%3A%2F%2Fcms-image-bucket-production-ap-northeast-1-a7d2.s3.ap-northeast-1.amazonaws.com%2Fimages%2F7%2F5%2F9%2F1%2F47381957-3-eng-GB%2FCropped-170981956120240307N%2520Kim%2520Jong%2520Un.jpg?width=780&fit=cover&gravity=faces&dpr=2&quality=medium&source=nar-cms&format=auto" class="card-img-top" alt="Weapon Image" style="height: 200px; object-fit: cover;">
            <div class="card-body">
              <h5 class="card-title">Tueur à gages</h5>
              <p class="card-text">Trouvez les meilleurs armes pour des tueurs à gages.</p>
              <a href="#" class="btn btn-warning">Learn More</a>
            </div>
          </div>
        </div>

        <!-- Example Weapon Card 2 -->
        <div class="col-md-4 mb-3">
          <div class="card h-100">
            <img src="https://s.abcnews.com/images/International/putin-rifle-rx-thg-180920_hpMain_16x9_992.jpg?w=992" class="card-img-top" alt="Weapon Image" style="height: 200px; object-fit: cover;">
            <div class="card-body">
              <h5 class="card-title">Tir sportif</h5>
              <p class="card-text">Trouvez les meilleurs armes pour le tir sportif.</p>
              <a href="#" class="btn btn-warning">Learn More</a>
            </div>
          </div>
        </div>

        <!-- Example Weapon Card 3 -->
        <div class="col-md-4 mb-3">
          <div class="card h-100">
            <img src="https://www.gannett-cdn.com/-mm-/67d77b70969a0c005d4a65ab900483945262d9b8/c=170-0-2830-2000/local/-/media/2017/03/28/USATODAY/USATODAY/636263025841031561-XXX-GIULIANI-TRUMP-SANTORUM-AND-SCOTT-ADDRESS-CI-89861016.JPG?width=2560" class="card-img-top" alt="Weapon Image" style="height: 200px; object-fit: cover;">
            <div class="card-body">
              <h5 class="card-title">Armée</h5>
              <p class="card-text">Trouvez les meilleurs armes de l'armée</p>
              <a href="#" class="btn btn-warning">Learn More</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Filtrage par catégorie avec des cases à cocher -->
    <div class="mb-4">
        <h4>Filtrage spécifique</h4>
    
        <!-- Categorie Porte -->
        <div>
        <h5>Portée</h5>
        <div class="form-check">
            <input type="checkbox" class="form-check-input" id="porte_courte" value="court" />
            <label class="form-check-label" for="porte_courte">Courte</label>
        </div>
        <div class="form-check">
            <input type="checkbox" class="form-check-input" id="porte_moyenne" value="moyenne" />
            <label class="form-check-label" for="porte_moyenne">Moyenne</label>
        </div>
        <div class="form-check">
            <input type="checkbox" class="form-check-input" id="porte_long" value="long" />
            <label class="form-check-label" for="porte_long">Long</label>
        </div>
        </div>
    
        <!-- Categorie Prise -->
        <div>
        <h5>Prise</h5>
        <div class="form-check">
            <input type="checkbox" class="form-check-input" id="prise_poing" value="arme-de-poing" />
            <label class="form-check-label" for="prise_value_1">Arme de Poing</label>
        </div>
        <div class="form-check">
            <input type="checkbox" class="form-check-input" id="prise_epaule" value="arme-d-epaule" />
            <label class="form-check-label" for="prise_value_2">Arme à l'épaule</label>
        </div>
        </div>
    
        <!-- Categorie Mécanisme -->
        <div>
        <h5>Mécanisme</h5>
        <div class="form-check">
            <input type="checkbox" class="form-check-input" id="mecanisme_repetition-manuelle" value="repetition-manuelle" />
            <label class="form-check-label" for="mecanisme_value_1">Répetition manuelle</label>
        </div>
        <div class="form-check">
            <input type="checkbox" class="form-check-input" id="mecanisme_tire-unique" value="tire-unique" />
            <label class="form-check-label" for="mecanisme_value_2">Tire unique</label>
        </div>
        <div class="form-check">
            <input type="checkbox" class="form-check-input" id="mecanisme_automatique" value="full-auto" />
            <label class="form-check-label" for="mecanisme_value_3">automatique</label>
        </div>
        <div class="form-check">
            <input type="checkbox" class="form-check-input" id="mecanisme_Semi-automatique" value="semi-auto" />
            <label class="form-check-label" for="mecanisme_value_4">Semi-automatique</label>
        </div>
        </div>
    </div>

     <!-- Search Bar -->
     <div class="input-group mb-4">
      <input type="text" id="searchBox" class="form-control" placeholder="Search weapons...">
      <button id="searchButton" class="btn btn-warning">Search</button>
    </div>


    <table>
        <thead>
            <tr>
                <th>Image</th>
                <th>Modèle</th>
                <th>Catégorie</th>
                <th>Mode</th>
                <th>Projectile</th>
                <th>Utilisation</th>
            </tr>
        </thead>
        <tbody id="armesTableBody">
            <!-- Les données seront insérées ici -->
        </tbody>
    </table>
  </div>

  <!-- Bootstrap JS -->
  <script src="script.js"></script>
  

  <script>
     let weaponData = [];
     let dataTemp = [...weaponData]; // Copie temporaire des données

    fetch('res.json') // Use res.json instead of res.txt
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();// Parse JSON
      })
      .then(jsonData => {
        console.log(jsonData)

        weaponData = jsonData; // Assign JSON data to weaponData
        dataTemp = [...weaponData]; // Copie temporaire des données

        updateButtons(); // Call your button update function
      })



  .catch(error => console.error('Error loading weapon data:', error));
  const attributes = ["utilisation", "categorie", "canon", "projectile", "porte", "mode"];
  let currentAttributeIndex = 0; // Index du niveau actuel dans la liste des attributs
  let currentSelection = []; // Garde la trace de la hiérarchie actuelle
 
  // Fonction pour extraire les parties possibles du niveau actuel
  function extractParts(data, attribute) {
    const parts = new Set();

    data.forEach(row => {
      row.forEach(item => {
        if (typeof item === 'string' && item.startsWith(attribute + '.')) {
          const partsArray = item.split('.');
          // Vérifie si l'élément correspond à la sélection actuelle
          if (partsArray.slice(0, currentSelection.length).join('.') === currentSelection.join('.')) {
            // Ajoute le niveau suivant dans la hiérarchie
            if (partsArray.length > currentSelection.length) {
              parts.add(partsArray.slice(0, currentSelection.length + 1).join('.'));
            }
          }
        }
      });
    });

    return [...parts];
  }

  // Fonction pour afficher les résultats dans un tableau
// Fonction pour afficher les résultats dans un tableau
// Fonction pour afficher les résultats dans un tableau
function displayResults(results) {
  console.log(results);
  const resultTableBody = document.getElementById('resultTable').getElementsByTagName('tbody')[0];
  resultTableBody.innerHTML = ''; // Réinitialise le contenu du tableau

  results.forEach((row, index) => {
    const tableRow = resultTableBody.insertRow(); // Crée une nouvelle ligne

    // Crée une cellule pour l'index
    const indexCell = tableRow.insertCell(0);
    indexCell.innerText = index + 1;

    // Inverse la ligne et affiche le dernier élément en premier
    const reversedRow = [...row].reverse();
    reversedRow.forEach((item, colIndex) => {
      const cell = tableRow.insertCell(colIndex + 1); // Ajoute une cellule
      cell.innerText = item; // Affiche la valeur de l'élément
    });
  });
}
  

function resetDecisionTree() {
  currentAttributeIndex = 0; // Revenir au premier attribut ("utilisation")
  currentSelection = []; // Réinitialiser la sélection
  dataTemp = [...weaponData]; // Réinitialiser les données temporaires avec toutes les armes
  updateButtons(); // Met à jour les boutons pour recommencer
}

// Ajout d'un Event Listener au bouton reset
document.getElementById('resetButton').addEventListener('click', resetDecisionTree);

  // Fonction pour mettre à jour les boutons dynamiquement
  function updateButtons() {
    const buttonContainer = document.getElementById('buttonContainer');
    const resultContainer = document.getElementById('resultContainer');
    const resultTableBody = document.getElementById('resultTable').getElementsByTagName('tbody')[0];

    buttonContainer.innerHTML = ''; // Réinitialise le conteneur de boutons
    resultTableBody.innerHTML = ''; // Réinitialise les résultats affichés

    if (currentAttributeIndex >= attributes.length) {
      // Si tous les niveaux ont été parcourus, afficher les résultats finaux
      const results = JSON.stringify(dataTemp, null, 2); // Vous pouvez formater les résultats ici comme vous le souhaitez

      // Appel à la fonction displayResults pour afficher les résultats dans un tableau
      displayResults(dataTemp); // Assurez-vous que les résultats sont passés correctement à la fonction
      return;
    }

    const currentAttribute = attributes[currentAttributeIndex];
    const nextParts = extractParts(dataTemp, currentAttribute);

    if (nextParts.length === 0) {
      // Si aucune option n'est disponible, arrête le processus
      resultContainer.innerText = `Aucune option disponible pour l'attribut "${currentAttribute}".`;
      return;
    }

    nextParts.forEach(part => {
      const button = document.createElement('button');
      button.innerText = part.split('.').pop(); // Affiche seulement le dernier élément après le dernier point
      button.classList.add('btn', 'btn-warning', 'm-1');
      button.onclick = () => {
        currentSelection = part.split('.'); // Met à jour la sélection actuelle
        dataTemp = dataTemp.filter(row => {
          // Garde uniquement les éléments qui incluent la sélection actuelle
          return row.some(item => 
            typeof item === 'string' && item.includes(part)
          );
        });

        // Passe à l'attribut suivant uniquement si des options valides existent
        const nextOptions = extractParts(dataTemp, currentAttribute);
        if (nextOptions.length === 0) {
          currentAttributeIndex++;
          currentSelection = [];
        }

        updateButtons(); // Rafraîchit les boutons après sélection
      };
      buttonContainer.appendChild(button);
    });
  }

</script>